THREE.DeviceOrientationControls=function(t){this.object=t,this.object.rotation.reorder("YXZ"),this.freeze=!0,this.movementSpeed=1,this.rollSpeed=.005,this.autoAlign=!0,this.autoForward=!1,this.alpha=0,this.beta=0,this.gamma=0,this.orient=0,this.alignQuaternion=new THREE.Quaternion,this.orientationQuaternion=new THREE.Quaternion;var e=new THREE.Quaternion,n=new THREE.Quaternion,i=new THREE.Vector3,o=new THREE.Matrix4,a=new THREE.Euler(0,0,0,"YXZ"),s=new THREE.Quaternion,r=new THREE.Vector3(0,0,1),h=new THREE.Vector3(0,1,0),c=new THREE.Vector3(0,0,0),d=new THREE.Euler,u=new THREE.Quaternion,l=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));this.deviceOrientation={},this.screenOrientation=window.orientation||0,this.onDeviceOrientationChangeEvent=function(t){this.deviceOrientation=t}.bind(this);var p=function(){switch(window.screen.orientation||window.screen.mozOrientation){case"landscape-primary":return 90;case"landscape-secondary":return-90;case"portrait-secondary":return 180;case"portrait-primary":return 0}return window.orientation||0};this.onScreenOrientationChangeEvent=function(){this.screenOrientation=p()}.bind(this),this.update=function(t){return function(){if(!this.freeze){var t=p();t!==this.screenOrientation&&(this.screenOrientation=t,this.autoAlign=!0),this.alpha=this.deviceOrientation.gamma?THREE.Math.degToRad(this.deviceOrientation.alpha):0,this.beta=this.deviceOrientation.beta?THREE.Math.degToRad(this.deviceOrientation.beta):0,this.gamma=this.deviceOrientation.gamma?THREE.Math.degToRad(this.deviceOrientation.gamma):0,this.orient=this.screenOrientation?THREE.Math.degToRad(this.screenOrientation):0,d.set(this.beta,this.alpha,-this.gamma,"YXZ"),e.setFromEuler(d),n.slerp(e,.5),this.orientationQuaternion.copy(this.autoAlign?e:n),this.orientationQuaternion.multiply(l),this.orientationQuaternion.multiply(u.setFromAxisAngle(r,-this.orient)),this.object.quaternion.copy(this.alignQuaternion),this.object.quaternion.multiply(this.orientationQuaternion),this.autoForward&&(i.set(0,0,-1).applyQuaternion(this.object.quaternion,"ZXY").setLength(this.movementSpeed/50),this.object.position.add(i)),this.autoAlign&&0!==this.alpha&&(this.autoAlign=!1,this.align())}}}(),this.align=function(){i.set(0,0,-1).applyQuaternion(s.copy(this.orientationQuaternion).inverse(),"ZXY"),a.setFromQuaternion(s.setFromRotationMatrix(o.lookAt(i,c,h))),a.set(0,a.y,0),this.alignQuaternion.setFromEuler(a)},this.connect=function(){return this.onScreenOrientationChangeEvent(),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent,!1),this.freeze=!1,this},this.disconnect=function(){this.freeze=!0,window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent,!1)}};
